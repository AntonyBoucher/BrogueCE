name: "Build (testing)"
on:
  push:

defaults:
  run:
    shell: bash

jobs:

  windows:
    runs-on: windows-latest
    steps:
    - name: "Checkout sources"
      uses: actions/checkout@v2
    - name: "Install dependencies"
      run: |
        version="2.0.12"
        archive="SDL2-devel-$version-mingw.tar.gz"
        curl -LO https://www.libsdl.org/release/$archive
        tar -xaf $archive
        cd SDL2-$version
        make native
    - name: "Compile"
      run: |
        make bin/brogue.exe
    - name: "Package"
      run: |
        cp .\SDL2\x86_64-w64-mingw32\bin\SDL2.dll .\bin\
        cp .\SDL2_image\x86_64-w64-mingw32\bin\zlib1.dll .\bin\
        cp .\SDL2_image\x86_64-w64-mingw32\bin\SDL2_image.dll .\bin\
        cp .\SDL2_image\x86_64-w64-mingw32\bin\libpng16-16.dll .\bin\
    - name: "Upload artifact"
      uses: actions/upload-artifact@v1
      with:
        name: windows-mingw-bin
        path: bin
